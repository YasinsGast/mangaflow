import { useState, useRef, useMemo, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { motion, useInView, AnimatePresence } from 'framer-motion';
import { 
  Book, 
  Search, 
  SlidersHorizontal, 
  Grid3x3, 
  LayoutGrid, 
  List, 
  ChevronDown,
  X,
  Sparkles,
  Star,
  Eye,
  Bookmark,
  Filter,
  User,
  Menu
} from 'lucide-react';

import ParticleSystem from '@/components/ParticleSystem';

export default function LibraryPage() {
  // Navbar state
  const [isScrolled, setIsScrolled] = useState(false);

  // Filter states
  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [sortBy, setSortBy] = useState('popular');
  const [viewMode, setViewMode] = useState<'grid-6' | 'grid-4' | 'grid-3' | 'list'>('grid-6');
  const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);
  const [categorySearch, setCategorySearch] = useState('');
  const [selectedStatus, setSelectedStatus] = useState('all');
  const [selectedType, setSelectedType] = useState('all');
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 24;

  // Scroll effect for navbar
  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 50);
    };

    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const navItems = [
    { label: 'Ana Sayfa', path: '/' },
    { label: 'Manga/Webtoon', path: '/library' },
    { label: 'Rastgele', path: '/random' },
    { label: 'Kategoriler', path: '/categories' },
  ];

  // All available categories (100+ örnek)
  const allCategories = [
    'Aksiyon', 'Macera', 'Romantik', 'Komedi', 'Drama', 'Fantezi', 'Bilim Kurgu',
    'Korku', 'Gizem', 'Gerilim', 'Psikolojik', 'Supernatural', 'Doğaüstü',
    'Okul Hayatı', 'Slice of Life', 'Spor', 'Müzik', 'Sanat', 'Tarih',
    'Askeri', 'Polisiye', 'Suç', 'Dedektif', 'Isekai', 'Reenkarnasyon',
    'Oyun', 'Sanal Gerçeklik', 'Mecha', 'Uzay', 'Zaman Yolculuğu',
    'Vampir', 'Cadı', 'Ninja', 'Samuray', 'Dövüş Sanatları', 'Silah Ustası',
    'Büyücü', 'Büyü', 'Ejderha', 'Demon', 'Melek', 'Tanrı', 'Ölümsüz',
    'Kült', 'Apokaliptik', 'Distopya', 'Post-Apokaliptik', 'Zombie',
    'Hayatta Kalma', 'Avcı', 'Kule', 'Zindan', 'Leveling', 'Sistemli',
    'Regresyon', 'Dönüş', 'İntikam', 'Güçlü MC', 'Zayıftan Güçlüye',
    'OP MC', 'Harem', 'Reverse Harem', 'Yaoi', 'Yuri', 'Shounen',
    'Shoujo', 'Seinen', 'Josei', 'Ecchi', 'Mature', 'Yetişkin',
    'Aile', 'Çocuklar', 'Eğitim', 'İş Dünyası', 'Ekonomi', 'Politika',
    'Krallık İnşası', 'Strateji', 'Savaş', 'Lider', 'İmparator', 'Kral',
    'Prens', 'Prenses', 'Şövalye', 'Sihirli Akademi', 'Okul', 'Öğretmen',
    'Doktor', 'Cerrah', 'Şifacı', 'Simyacı', 'Aşçı', 'Yemek', 'Mutfak',
    'Sanatçı', 'Ressam', 'Müzisyen', 'İdol', 'Aktör', 'Ünlü', 'Medya',
    'Yayıncı', 'Streamer', 'Gamer', 'E-Spor', 'MMORPG', 'VRMMORPG',
    'Hayvanlar', 'Evcil Hayvan', 'Canavar', 'Beast Tamer', 'Necromancer',
    'Büyü Dehası', 'Pedestal', 'Murim', 'Wuxia', 'Xianxia', 'Xuanhuan',
  ];

  // Sort options
  const sortOptions = [
    { value: 'popular', label: 'En Popüler' },
    { value: 'newest', label: 'Yeni Eklenenler' },
    { value: 'rating', label: 'En Yüksek Puan' },
    { value: 'views', label: 'En Çok Görüntülenen' },
    { value: 'az', label: 'A-Z' },
    { value: 'za', label: 'Z-A' },
    { value: 'latest-chapter', label: 'En Yeni Bölüm' },
  ];

  // Sample manga data (expanded from HomePage)
  const allManga = [
    {
      id: 1,
      title: 'Solo Leveling',
      cover: 'https://images.unsplash.com/photo-1618519764620-7403abdbdfe9?w=400&h=600&fit=crop',
      rating: 9.8,
      views: '2.5M',
      genre: 'Aksiyon',
      categories: ['Aksiyon', 'Fantezi', 'Leveling', 'Sistemli', 'OP MC'],
      chapters: 179,
      status: 'completed',
      type: 'manhwa',
    },
    {
      id: 2,
      title: 'Tower of God',
      cover: 'https://images.unsplash.com/photo-1612036782180-6f0b6cd846fe?w=400&h=600&fit=crop',
      rating: 9.5,
      views: '1.8M',
      genre: 'Fantezi',
      categories: ['Fantezi', 'Aksiyon', 'Kule', 'Macera'],
      chapters: 586,
      status: 'ongoing',
      type: 'webtoon',
    },
    {
      id: 3,
      title: 'The Beginning After The End',
      cover: 'https://images.unsplash.com/photo-1578632767115-351597cf2477?w=400&h=600&fit=crop',
      rating: 9.7,
      views: '2.1M',
      genre: 'Fantezi',
      categories: ['Fantezi', 'Reenkarnasyon', 'Büyü', 'Okul Hayatı'],
      chapters: 168,
      status: 'ongoing',
      type: 'webtoon',
    },
    {
      id: 4,
      title: 'Omniscient Reader\'s Viewpoint',
      cover: 'https://images.unsplash.com/photo-1626618012641-bfbca5a31239?w=400&h=600&fit=crop',
      rating: 9.6,
      views: '1.9M',
      genre: 'Fantezi',
      categories: ['Fantezi', 'Aksiyon', 'Apokaliptik', 'Hayatta Kalma'],
      chapters: 123,
      status: 'ongoing',
      type: 'webtoon',
    },
    {
      id: 5,
      title: 'Martial Peak',
      cover: 'https://images.unsplash.com/photo-1607604276583-eef5d076aa5f?w=400&h=600&fit=crop',
      rating: 9.3,
      views: '1.5M',
      genre: 'Aksiyon',
      categories: ['Aksiyon', 'Wuxia', 'Dövüş Sanatları', 'Macera'],
      chapters: 3423,
      status: 'ongoing',
      type: 'manhua',
    },
    {
      id: 6,
      title: 'One Piece',
      cover: 'https://images.unsplash.com/photo-1578632292335-df3abbb0d586?w=400&h=600&fit=crop',
      rating: 9.4,
      views: '3.2M',
      genre: 'Macera',
      categories: ['Macera', 'Aksiyon', 'Komedi', 'Fantezi'],
      chapters: 1098,
      status: 'ongoing',
      type: 'manga',
    },
    // Add more manga to reach 50+ entries
    ...Array.from({ length: 44 }, (_, i) => ({
      id: i + 7,
      title: `Manga/Webtoon ${i + 7}`,
      cover: `https://images.unsplash.com/photo-${1578632767115 + i}?w=400&h=600&fit=crop`,
      rating: 8.0 + Math.random() * 1.5,
      views: `${Math.floor(Math.random() * 900 + 100)}K`,
      genre: allCategories[Math.floor(Math.random() * 10)],
      categories: Array.from({ length: 3 }, () => allCategories[Math.floor(Math.random() * allCategories.length)]),
      chapters: Math.floor(Math.random() * 300 + 50),
      status: ['ongoing', 'completed', 'hiatus'][Math.floor(Math.random() * 3)],
      type: ['manga', 'manhwa', 'manhua', 'webtoon'][Math.floor(Math.random() * 4)],
    })),
  ];

  // Filter categories based on search
  const filteredCategories = allCategories.filter(cat =>
    cat.toLowerCase().includes(categorySearch.toLowerCase())
  );

  // Toggle category selection
  const toggleCategory = (category: string) => {
    setSelectedCategories(prev =>
      prev.includes(category)
        ? prev.filter(c => c !== category)
        : [...prev, category]
    );
  };

  // Remove category
  const removeCategory = (category: string) => {
    setSelectedCategories(prev => prev.filter(c => c !== category));
  };

  // Filter and sort manga
  const filteredAndSortedManga = useMemo(() => {
    let result = [...allManga];

    // Filter by search query
    if (searchQuery) {
      result = result.filter(manga =>
        manga.title.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // Filter by categories
    if (selectedCategories.length > 0) {
      result = result.filter(manga =>
        selectedCategories.some(cat => manga.categories.includes(cat))
      );
    }

    // Filter by status
    if (selectedStatus !== 'all') {
      result = result.filter(manga => manga.status === selectedStatus);
    }

    // Filter by type
    if (selectedType !== 'all') {
      result = result.filter(manga => manga.type === selectedType);
    }

    // Sort
    switch (sortBy) {
      case 'popular':
        result.sort((a, b) => b.rating - a.rating);
        break;
      case 'newest':
        result.sort((a, b) => b.id - a.id);
        break;
      case 'rating':
        result.sort((a, b) => b.rating - a.rating);
        break;
      case 'views':
        result.sort((a, b) => {
          const aViews = parseFloat(a.views.replace(/[KM]/g, '')) * (a.views.includes('M') ? 1000 : 1);
          const bViews = parseFloat(b.views.replace(/[KM]/g, '')) * (b.views.includes('M') ? 1000 : 1);
          return bViews - aViews;
        });
        break;
      case 'az':
        result.sort((a, b) => a.title.localeCompare(b.title));
        break;
      case 'za':
        result.sort((a, b) => b.title.localeCompare(a.title));
        break;
      case 'latest-chapter':
        result.sort((a, b) => b.id - a.id);
        break;
    }

    return result;
  }, [searchQuery, selectedCategories, selectedStatus, selectedType, sortBy]);

  // Pagination
  const totalPages = Math.ceil(filteredAndSortedManga.length / itemsPerPage);
  const paginatedManga = filteredAndSortedManga.slice(
    (currentPage - 1) * itemsPerPage,
    currentPage * itemsPerPage
  );

  // Grid class based on view mode
  const getGridClass = () => {
    switch (viewMode) {
      case 'grid-6':
        return 'grid-cols-2 md:grid-cols-3 lg:grid-cols-6';
      case 'grid-4':
        return 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4';
      case 'grid-3':
        return 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3';
      case 'list':
        return 'grid-cols-1';
      default:
        return 'grid-cols-2 md:grid-cols-3 lg:grid-cols-6';
    }
  };

  return (
    <div className="min-h-screen bg-background-pure-dark">
      {/* Animated Navigation Bar */}
      <motion.nav
        className={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${
          isScrolled 
            ? 'backdrop-blur-xl bg-slate-900/80 shadow-lg shadow-purple-500/10' 
            : 'bg-transparent'
        }`}
        initial={{ y: -100, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        transition={{ duration: 0.6, ease: 'easeOut' }}
        style={{
          borderBottom: isScrolled ? '1px solid rgba(139, 92, 246, 0.2)' : 'none',
        }}
      >
        <div className="container mx-auto px-6">
          <div className="flex items-center justify-between h-20">
            
            {/* Logo/Brand */}
            <motion.div
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.2, duration: 0.5 }}
            >
              <Link to="/" className="flex items-center gap-2 group">
                <motion.div
                  className="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center"
                  whileHover={{ scale: 1.05, rotate: 5 }}
                  whileTap={{ scale: 0.95 }}
                >
                  <Book className="h-6 w-6 text-white" />
                </motion.div>
                <span className="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                  MangaFlow
                </span>
              </Link>
            </motion.div>

            {/* Navigation Links - Desktop */}
            <motion.div
              className="hidden md:flex items-center gap-8"
              initial={{ opacity: 0, y: -20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3, duration: 0.5 }}
            >
              {navItems.map((item, idx) => (
                <Link key={item.path} to={item.path}>
                  <motion.span
                    className="text-slate-300 hover:text-white font-medium relative group cursor-pointer"
                    whileHover={{ y: -2 }}
                    transition={{ duration: 0.2 }}
                  >
                    {item.label}
                    <motion.span
                      className="absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-blue-400 to-purple-400 group-hover:w-full transition-all duration-300"
                    />
                  </motion.span>
                </Link>
              ))}
            </motion.div>

            {/* Right Actions */}
            <motion.div
              className="flex items-center gap-4"
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.4, duration: 0.5 }}
            >
              {/* Search Icon */}
              <motion.button
                className="p-2 rounded-lg hover:bg-white/10 transition-colors"
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                aria-label="Ara"
              >
                <Search className="h-5 w-5 text-slate-300" />
              </motion.button>

              {/* User Icon */}
              <motion.button
                className="p-2 rounded-lg hover:bg-white/10 transition-colors"
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                aria-label="Profil"
              >
                <User className="h-5 w-5 text-slate-300" />
              </motion.button>

              {/* Mobile Menu Icon */}
              <motion.button
                className="md:hidden p-2 rounded-lg hover:bg-white/10 transition-colors"
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                aria-label="Menü"
              >
                <Menu className="h-5 w-5 text-slate-300" />
              </motion.button>
            </motion.div>

          </div>
        </div>
      </motion.nav>

      {/* Hero Section */}
      <section className="relative pt-32 pb-16 overflow-hidden border-b border-purple-500/20">
        <div className="absolute inset-0 z-0">
          <ParticleSystem />
        </div>
        <div className="absolute inset-0 z-10 bg-gradient-to-b from-slate-900/95 via-slate-900/90 to-background-pure-dark" />

        <div className="relative z-20 container mx-auto px-6">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
            className="text-center"
          >
            <motion.div
              className="inline-flex items-center gap-2 px-4 py-2 rounded-full backdrop-blur-md mb-4"
              style={{
                background: 'rgba(236, 72, 153, 0.1)',
                border: '1px solid rgba(236, 72, 153, 0.3)',
              }}
            >
              <Book className="h-5 w-5 text-pink-400" />
              <span className="text-sm font-medium text-pink-300">Kütüphane</span>
            </motion.div>

            <h1 className="text-4xl md:text-5xl font-bold mb-4">
              <span className="bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 bg-clip-text text-transparent">
                Manga & Webtoon Koleksiyonu
              </span>
            </h1>
            <p className="text-slate-400 text-lg max-w-2xl mx-auto">
              {filteredAndSortedManga.length} seri arasından favorilerinizi keşfedin
            </p>
          </motion.div>
        </div>
      </section>

      {/* Filters Section */}
      <section className="relative py-8 border-b border-purple-500/10 z-30">
        <div className="absolute inset-0 z-0 bg-gradient-to-b from-background-pure-dark to-slate-900/50" />
        
        <div className="relative z-10 container mx-auto px-6">
          <div className="space-y-6">
            {/* Search Bar */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5 }}
              className="relative"
            >
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-slate-400" />
              <input
                type="text"
                placeholder="Manga veya webtoon ara..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="w-full pl-12 pr-4 py-4 rounded-2xl backdrop-blur-md text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              />
            </motion.div>

            {/* Filter Controls */}
            <div className="flex flex-wrap gap-4">
              {/* Category Dropdown */}
              <div className="relative flex-1 min-w-[250px] z-50">
                <button
                  onClick={() => setShowCategoryDropdown(!showCategoryDropdown)}
                  className="w-full px-4 py-3 rounded-xl backdrop-blur-md flex items-center justify-between gap-2 text-white hover:border-purple-500/50 transition-all"
                  style={{
                    background: 'rgba(15, 23, 42, 0.6)',
                    border: '1px solid rgba(139, 92, 246, 0.2)',
                  }}
                >
                  <div className="flex items-center gap-2">
                    <Filter className="h-5 w-5 text-purple-400" />
                    <span className="text-sm">
                      Kategoriler {selectedCategories.length > 0 && `(${selectedCategories.length})`}
                    </span>
                  </div>
                  <ChevronDown className={`h-4 w-4 transition-transform ${showCategoryDropdown ? 'rotate-180' : ''}`} />
                </button>

                <AnimatePresence>
                  {showCategoryDropdown && (
                    <motion.div
                      initial={{ opacity: 0, y: -10 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: -10 }}
                      className="absolute top-full mt-2 w-full max-h-96 overflow-hidden rounded-xl backdrop-blur-xl z-[9999]"
                      style={{
                        background: 'rgba(15, 23, 42, 0.95)',
                        border: '1px solid rgba(139, 92, 246, 0.3)',
                        boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',
                      }}
                    >
                      {/* Category Search */}
                      <div className="p-3 border-b border-purple-500/20">
                        <input
                          type="text"
                          placeholder="Kategori ara..."
                          value={categorySearch}
                          onChange={(e) => setCategorySearch(e.target.value)}
                          className="w-full px-3 py-2 rounded-lg bg-slate-800/50 text-white text-sm placeholder-slate-400 focus:outline-none focus:ring-1 focus:ring-purple-500/50"
                        />
                      </div>

                      {/* Category List */}
                      <div className="max-h-64 overflow-y-auto p-2 space-y-1">
                        {filteredCategories.map((category) => (
                          <button
                            key={category}
                            onClick={() => toggleCategory(category)}
                            className={`w-full px-3 py-2 rounded-lg text-left text-sm transition-all ${
                              selectedCategories.includes(category)
                                ? 'bg-purple-500/20 text-purple-300'
                                : 'hover:bg-slate-800/50 text-slate-300'
                            }`}
                          >
                            {category}
                          </button>
                        ))}
                      </div>
                    </motion.div>
                  )}
                </AnimatePresence>
              </div>

              {/* Sort Dropdown */}
              <select
                value={sortBy}
                onChange={(e) => setSortBy(e.target.value)}
                className="px-4 py-3 rounded-xl backdrop-blur-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50 cursor-pointer"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              >
                {sortOptions.map(option => (
                  <option key={option.value} value={option.value} className="bg-slate-900">
                    {option.label}
                  </option>
                ))}
              </select>

              {/* Status Filter */}
              <select
                value={selectedStatus}
                onChange={(e) => setSelectedStatus(e.target.value)}
                className="px-4 py-3 rounded-xl backdrop-blur-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50 cursor-pointer"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              >
                <option value="all" className="bg-slate-900">Tüm Durumlar</option>
                <option value="ongoing" className="bg-slate-900">Devam Ediyor</option>
                <option value="completed" className="bg-slate-900">Tamamlandı</option>
                <option value="hiatus" className="bg-slate-900">Ara Verdi</option>
              </select>

              {/* Type Filter */}
              <select
                value={selectedType}
                onChange={(e) => setSelectedType(e.target.value)}
                className="px-4 py-3 rounded-xl backdrop-blur-md text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50 cursor-pointer"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              >
                <option value="all" className="bg-slate-900">Tüm Türler</option>
                <option value="manga" className="bg-slate-900">Manga</option>
                <option value="manhwa" className="bg-slate-900">Manhwa</option>
                <option value="manhua" className="bg-slate-900">Manhua</option>
                <option value="webtoon" className="bg-slate-900">Webtoon</option>
              </select>

              {/* View Mode Toggle */}
              <div className="flex gap-2 px-2 py-2 rounded-xl backdrop-blur-md"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              >
                <button
                  onClick={() => setViewMode('grid-6')}
                  className={`p-2 rounded-lg transition-all ${
                    viewMode === 'grid-6'
                      ? 'bg-purple-500/30 text-purple-300'
                      : 'text-slate-400 hover:text-white'
                  }`}
                  title="Grid 6 Kolon"
                >
                  <Grid3x3 className="h-5 w-5" />
                </button>
                <button
                  onClick={() => setViewMode('grid-4')}
                  className={`p-2 rounded-lg transition-all ${
                    viewMode === 'grid-4'
                      ? 'bg-purple-500/30 text-purple-300'
                      : 'text-slate-400 hover:text-white'
                  }`}
                  title="Grid 4 Kolon"
                >
                  <LayoutGrid className="h-5 w-5" />
                </button>
                <button
                  onClick={() => setViewMode('grid-3')}
                  className={`p-2 rounded-lg transition-all ${
                    viewMode === 'grid-3'
                      ? 'bg-purple-500/30 text-purple-300'
                      : 'text-slate-400 hover:text-white'
                  }`}
                  title="Grid 3 Kolon"
                >
                  <LayoutGrid className="h-4 w-4" />
                </button>
                <button
                  onClick={() => setViewMode('list')}
                  className={`p-2 rounded-lg transition-all ${
                    viewMode === 'list'
                      ? 'bg-purple-500/30 text-purple-300'
                      : 'text-slate-400 hover:text-white'
                  }`}
                  title="Liste Görünümü"
                >
                  <List className="h-5 w-5" />
                </button>
              </div>
            </div>

            {/* Selected Categories Tags */}
            {selectedCategories.length > 0 && (
              <motion.div
                initial={{ opacity: 0, height: 0 }}
                animate={{ opacity: 1, height: 'auto' }}
                exit={{ opacity: 0, height: 0 }}
                className="flex flex-wrap gap-2"
              >
                {selectedCategories.map((category) => (
                  <motion.button
                    key={category}
                    initial={{ opacity: 0, scale: 0.8 }}
                    animate={{ opacity: 1, scale: 1 }}
                    exit={{ opacity: 0, scale: 0.8 }}
                    onClick={() => removeCategory(category)}
                    className="px-3 py-1.5 rounded-full backdrop-blur-md flex items-center gap-2 text-sm text-purple-300 hover:bg-purple-500/30 transition-all"
                    style={{
                      background: 'rgba(139, 92, 246, 0.2)',
                      border: '1px solid rgba(139, 92, 246, 0.3)',
                    }}
                  >
                    {category}
                    <X className="h-3 w-3" />
                  </motion.button>
                ))}
              </motion.div>
            )}
          </div>
        </div>
      </section>

      {/* Manga Grid */}
      <section className="relative py-12">
        <div className="absolute inset-0 z-0">
          <ParticleSystem />
        </div>
        <div className="absolute inset-0 z-10 bg-gradient-to-b from-slate-900/50 via-slate-900/95 to-background-pure-dark" />

        <div className="relative z-20 container mx-auto px-6">
          <AnimatePresence mode="wait">
            <motion.div
              key={`${viewMode}-${currentPage}`}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.4 }}
              className={`grid ${getGridClass()} gap-6`}
            >
              {paginatedManga.map((manga, idx) => (
                <MangaCard key={manga.id} manga={manga} index={idx} viewMode={viewMode} />
              ))}
            </motion.div>
          </AnimatePresence>

          {/* Pagination */}
          {totalPages > 1 && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 }}
              className="flex justify-center items-center gap-2 mt-12"
            >
              <button
                onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                disabled={currentPage === 1}
                className="px-4 py-2 rounded-lg backdrop-blur-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-purple-500/20 transition-all"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              >
                <span className="text-white">Önceki</span>
              </button>

              <div className="flex gap-2">
                {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                  let pageNum;
                  if (totalPages <= 5) {
                    pageNum = i + 1;
                  } else if (currentPage <= 3) {
                    pageNum = i + 1;
                  } else if (currentPage >= totalPages - 2) {
                    pageNum = totalPages - 4 + i;
                  } else {
                    pageNum = currentPage - 2 + i;
                  }

                  return (
                    <button
                      key={pageNum}
                      onClick={() => setCurrentPage(pageNum)}
                      className={`w-10 h-10 rounded-lg backdrop-blur-md transition-all ${
                        currentPage === pageNum
                          ? 'bg-purple-500/30 text-purple-300 border-purple-500/50'
                          : 'hover:bg-purple-500/10 text-slate-400'
                      }`}
                      style={{
                        background: currentPage === pageNum ? 'rgba(139, 92, 246, 0.3)' : 'rgba(15, 23, 42, 0.6)',
                        border: `1px solid ${currentPage === pageNum ? 'rgba(139, 92, 246, 0.5)' : 'rgba(139, 92, 246, 0.2)'}`,
                      }}
                    >
                      {pageNum}
                    </button>
                  );
                })}
              </div>

              <button
                onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                disabled={currentPage === totalPages}
                className="px-4 py-2 rounded-lg backdrop-blur-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-purple-500/20 transition-all"
                style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  border: '1px solid rgba(139, 92, 246, 0.2)',
                }}
              >
                <span className="text-white">Sonraki</span>
              </button>
            </motion.div>
          )}
        </div>
      </section>
    </div>
  );
}

// Manga Card Component
interface MangaCardProps {
  manga: {
    id: number;
    title: string;
    cover: string;
    rating: number;
    views: string;
    genre: string;
    chapters: number;
  };
  index: number;
  viewMode: 'grid-6' | 'grid-4' | 'grid-3' | 'list';
}

function MangaCard({ manga, index, viewMode }: MangaCardProps) {
  const cardRef = useRef(null);
  const isInView = useInView(cardRef, { once: true, amount: 0.3 });

  if (viewMode === 'list') {
    // List view layout
    return (
      <motion.div
        ref={cardRef}
        initial={{ opacity: 0, x: -50 }}
        animate={isInView ? { opacity: 1, x: 0 } : { opacity: 0, x: -50 }}
        transition={{ duration: 0.5, delay: index * 0.05 }}
      >
        <Link to={`/manga/${manga.id}`}>
          <motion.div
            className="group flex gap-6 p-4 rounded-2xl overflow-hidden cursor-pointer"
            style={{
              background: 'rgba(15, 23, 42, 0.6)',
              backdropFilter: 'blur(12px)',
              border: '1px solid rgba(139, 92, 246, 0.2)',
            }}
            whileHover={{
              scale: 1.01,
              borderColor: 'rgba(139, 92, 246, 0.5)',
            }}
            transition={{ duration: 0.3 }}
          >
            <div className="relative w-32 aspect-[3/4] overflow-hidden rounded-xl flex-shrink-0">
              <img
                src={manga.cover}
                alt={manga.title}
                className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
              />
              <div className="absolute top-2 left-2 px-2 py-1 rounded-md backdrop-blur-md text-xs font-semibold"
                style={{
                  background: 'rgba(236, 72, 153, 0.9)',
                  color: 'white',
                }}
              >
                {manga.genre}
              </div>
            </div>

            <div className="flex-1 flex flex-col justify-between py-2">
              <div>
                <h3 className="text-xl font-bold text-white mb-2 line-clamp-1">
                  {manga.title}
                </h3>
                <div className="flex items-center gap-4 text-sm text-slate-400">
                  <div className="flex items-center gap-1">
                    <Star className="h-4 w-4 text-yellow-400 fill-yellow-400" />
                    <span>{manga.rating}</span>
                  </div>
                  <div className="flex items-center gap-1">
                    <Eye className="h-4 w-4" />
                    <span>{manga.views}</span>
                  </div>
                  <div>
                    <span>{manga.chapters} Bölüm</span>
                  </div>
                </div>
              </div>

              <div className="flex items-center justify-between mt-4">
                <motion.button
                  className="px-4 py-2 rounded-lg backdrop-blur-md flex items-center gap-2"
                  style={{
                    background: 'rgba(139, 92, 246, 0.2)',
                    border: '1px solid rgba(139, 92, 246, 0.3)',
                  }}
                  whileHover={{ scale: 1.05, backgroundColor: 'rgba(139, 92, 246, 0.3)' }}
                  whileTap={{ scale: 0.95 }}
                >
                  <Bookmark className="h-4 w-4 text-purple-400" />
                  <span className="text-purple-300 text-sm">Kaydet</span>
                </motion.button>

                <motion.div
                  className="flex items-center gap-1 text-purple-400 font-medium"
                  whileHover={{ x: 5 }}
                >
                  <span>Oku</span>
                  <motion.span
                    animate={{ x: [0, 3, 0] }}
                    transition={{ duration: 1.5, repeat: Infinity }}
                  >
                    →
                  </motion.span>
                </motion.div>
              </div>
            </div>
          </motion.div>
        </Link>
      </motion.div>
    );
  }

  // Grid view layout (same as HomePage)
  return (
    <motion.div
      ref={cardRef}
      initial={{ opacity: 0, y: 50 }}
      animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 50 }}
      transition={{ duration: 0.5, delay: index * 0.05 }}
      className="h-full"
    >
      <Link to={`/manga/${manga.id}`} className="h-full block">
        <motion.div
          className="group relative rounded-2xl overflow-hidden cursor-pointer h-full flex flex-col"
          style={{
            background: 'rgba(15, 23, 42, 0.6)',
            backdropFilter: 'blur(12px)',
            border: '1px solid rgba(139, 92, 246, 0.2)',
          }}
          whileHover={{
            scale: 1.03,
            borderColor: 'rgba(139, 92, 246, 0.5)',
          }}
          transition={{ duration: 0.3 }}
        >
          <div className="relative aspect-[3/4] overflow-hidden flex-shrink-0">
            <motion.img
              src={manga.cover}
              alt={manga.title}
              className="w-full h-full object-cover"
              whileHover={{ scale: 1.1 }}
              transition={{ duration: 0.6 }}
            />

            <div className="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent opacity-80 group-hover:opacity-90 transition-opacity duration-300" />

            <motion.div
              className="absolute top-3 right-3 p-2 rounded-lg backdrop-blur-md"
              style={{
                background: 'rgba(15, 23, 42, 0.8)',
                border: '1px solid rgba(139, 92, 246, 0.3)',
              }}
              whileHover={{ scale: 1.1, backgroundColor: 'rgba(139, 92, 246, 0.3)' }}
              whileTap={{ scale: 0.9 }}
            >
              <Bookmark className="h-5 w-5 text-purple-400" />
            </motion.div>

            <div
              className="absolute top-3 left-3 px-3 py-1 rounded-full backdrop-blur-md text-xs font-semibold"
              style={{
                background: 'rgba(236, 72, 153, 0.8)',
                border: '1px solid rgba(236, 72, 153, 0.5)',
                color: 'white',
              }}
            >
              {manga.genre}
            </div>

            <div className="absolute bottom-3 left-3 right-3 flex items-center justify-between text-white text-sm">
              <div className="flex items-center gap-1">
                <Star className="h-4 w-4 text-yellow-400 fill-yellow-400" />
                <span className="font-semibold">{manga.rating}</span>
              </div>
              <div className="flex items-center gap-1">
                <Eye className="h-4 w-4" />
                <span>{manga.views}</span>
              </div>
            </div>
          </div>

          <div className="p-4 h-[100px] flex flex-col justify-between">
            <h3 className="text-lg font-bold text-white line-clamp-2 overflow-hidden">
              {manga.title}
            </h3>

            <div className="flex items-center justify-between text-sm">
              <span className="text-slate-400">{manga.chapters} Bölüm</span>
              <motion.div
                className="flex items-center gap-1"
                whileHover={{ x: 5 }}
              >
                <span className="text-purple-400 font-medium">Oku</span>
                <motion.span
                  animate={{ x: [0, 3, 0] }}
                  transition={{ duration: 1.5, repeat: Infinity }}
                >
                  →
                </motion.span>
              </motion.div>
            </div>
          </div>

          <motion.div
            className="absolute inset-0 rounded-2xl pointer-events-none"
            style={{
              boxShadow: '0 0 0 0 rgba(139, 92, 246, 0)',
            }}
            whileHover={{
              boxShadow: '0 0 30px 5px rgba(139, 92, 246, 0.3)',
            }}
            transition={{ duration: 0.3 }}
          />
        </motion.div>
      </Link>
    </motion.div>
  );
}
